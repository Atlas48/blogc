sudo: required
language: c

addons:
  apt:
    packages:
      - gcc-mingw-w64-i686
      - gcc-mingw-w64-x86-64
      - libcmocka-dev
      - rpm
      - valgrind

matrix:
  include:
    - compiler: gcc
      env:
        - TARGET=distcheck
    - compiler: clang
      env:
        - TARGET=distcheck
        - DISABLE_PUBLISHER=1
    - os: osx
      compiler: clang
      env:
        - TARGET=distcheck
        - DISABLE_PUBLISHER=1
    - compiler: gcc
      env:
        - TARGET=valgrind
    - compiler: clang
      env:
        - TARGET=valgrind
    - compiler: clang
      env:
        - TARGET=clang-analyzer
    - compiler: gcc
      env:
        - TARGET=dist-srpm
    - compiler: gcc
      env:
        - TARGET=static
    - compiler: gcc
      env:
        - TARGET=check-make-embedded
    - compiler: gcc
      env:
        - TARGET=win32
    - compiler: gcc
      env:
        - TARGET=win64

install:
  - gem install ronn
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install cmocka; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install xz; fi

script: curl -sSf https://yatr.rgm.io/run.sh | bash
